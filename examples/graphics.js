var tessel_logo = [
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x80, 0x80, 0xC0, 0xE0, 0xE0, 0x70, 0x3C, 0x3E, 0x36, 0x36, 0x3E, 0x1C, 0x00, 0x00, 0x00,
0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xE0, 0xF0, 0x70, 0x38, 0x38,
0x1C, 0x0E, 0x0E, 0x07, 0x07, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x07, 0x0E, 0x0E, 0x1C, 0x38, 0x38, 0x70, 0xF0,
0xE0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF,
0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0xFC,
0xFC, 0x00, 0x00, 0xFC, 0xFC, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x01, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x3E, 0x36, 0x3E, 0x3E, 0x78, 0x70, 0xE0, 0xE0, 0xC0, 0x80,
0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x00, 0x00, 0x03, 0x03, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3E, 0x3F, 0x37, 0x3F, 0x3C, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x01, 0x03, 0x03, 0x07, 0x07, 0x0E, 0x0E, 0x1C, 0x38, 0x38, 0x70, 0x70, 0x70, 0x70,
0x38, 0x38, 0x1C, 0x0C, 0x0E, 0x07, 0x07, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00];

var The_End = [
0x00, 0x80, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xE0, 0x60, 0x00, 0x00,   // 0x0010 (16) pixels
0x80, 0xC0, 0xC0, 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xE0,   // 0x0020 (32) pixels
0xC0, 0xC0, 0xC0, 0xC0, 0xE0, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xC0, 0xE0,   // 0x0030 (48) pixels
0xE0, 0xC0, 0xC0, 0xC0, 0xE0, 0xE0, 0x00, 0x00, 0x00, 0x80, 0x80, 0xC0, 0xC0, 0xC0, 0x00, 0x00,   // 0x0040 (64) pixels
0x00, 0x00, 0x80, 0xE0, 0xF0, 0xF0, 0x60, 0x40, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0xE0, 0xC0, 0xC0,   // 0x0050 (80) pixels
0x80, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x81, 0xFC, 0xFF, 0x0F, 0x03, 0x00, 0x00, 0x00,   // 0x0060 (96) pixels
0xEE, 0x6F, 0x67, 0xFF, 0xFF, 0x7F, 0x71, 0x30, 0xF0, 0xFF, 0x3F, 0x39, 0x38, 0x18, 0x00, 0x01,   // 0x0070 (112) pixels
0x00, 0xF8, 0xFF, 0x1F, 0x0F, 0x0C, 0x0D, 0x8D, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,   // 0x0080 (128) pixels
0x00, 0xC0, 0xFF, 0x7F, 0x0F, 0x0C, 0x0D, 0x0D, 0x84, 0x80, 0x80, 0x07, 0x07, 0x83, 0xFF, 0xFF,   // 0x0090 (144) pixels
0x1F, 0x3F, 0xFE, 0xF8, 0xF8, 0xFE, 0xDF, 0x03, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xFF, 0x1F, 0x00,   // 0x00A0 (160) pixels
0x00, 0x80, 0x81, 0xC3, 0xE7, 0x7F, 0x3E, 0x00, 0x00, 0x00, 0x00, 0x06, 0x07, 0x07, 0x03, 0x00,   // 0x00B0 (176) pixels
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x0F, 0x07, 0x03, 0x00, 0x00, 0x0F, 0x0F, 0x07, 0x00,   // 0x00C0 (192) pixels
0x00, 0x06, 0x06, 0x3F, 0x1F, 0x0F, 0x0F, 0x0E, 0x06, 0x06, 0x06, 0x07, 0x07, 0x03, 0x00, 0x00,   // 0x00D0 (208) pixels
0x00, 0x00, 0x06, 0x1F, 0x3F, 0x1F, 0x0F, 0x0E, 0x06, 0x06, 0x06, 0x07, 0x07, 0x07, 0x03, 0x00,   // 0x00E0 (224) pixels
0x06, 0x0F, 0x07, 0x01, 0x00, 0x00, 0x00, 0x01, 0x0F, 0x07, 0x03, 0x00, 0x00, 0x18, 0x1C, 0x1F,   // 0x00F0 (240) pixels
0x0F, 0x07, 0x06, 0x07, 0x03, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 
];

var pacman1 = [
0x80, 0xE0, 0xF0, 0xF8, 0xFC, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7E, 0x3E, 0x1C,   // 0x0010 (16) pixels
0x0C, 0x00, 0x00, 0x00, 0x1F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF9,   // 0x0020 (32) pixels
0xF0, 0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x07, 0x0F,   // 0x0030 (48) pixels
0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x07, 0x07, 0x03, 0x03, 0x00, 0x00, 0x00, 
];

var pacman2 = [
0x80, 0xE0, 0xF0, 0xF8, 0xFC, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xFE, 0x7C,   // 0x0010 (16) pixels
0x7C, 0x38, 0x20, 0x00, 0x1F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF9,   // 0x0020 (32) pixels
0xF9, 0xF0, 0xF0, 0xE0, 0xE0, 0xC0, 0x40, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x07, 0x0F,   // 0x0030 (48) pixels
0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x07, 0x07, 0x03, 0x03, 0x01, 0x00, 0x00, 
];

var pacman3 = [
0x80, 0xE0, 0xF0, 0xF8, 0xFC, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xFE, 0xFC,   // 0x0010 (16) pixels
0xF8, 0xF0, 0xE0, 0x80, 0x1F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 0x0020 (32) pixels
0xFF, 0xFF, 0xFF, 0xFF, 0xFB, 0xF9, 0x79, 0x19, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x07, 0x0F,   // 0x0030 (48) pixels
0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x07, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 
];

var pill = [
0x0E, 0x1F, 0x1F, 0x1F, 0x0E, 
];

var tessel = require('tessel');
var nokia5110 = require('../').use(tessel.port['D']);

nokia5110.on('ready', function(){
  //nokia5110.setBacklight(true);
  drawLogo(function(){
    demoIntro(function(){
      drawLines(function(){
        drawEye(function(){
          drawRectangles(function(){
            drawCircles(function(){
              drawGraph(function(){
                theEnd(function(){
                  console.log("Demo Finished!");
                });
              });
            });
          });
        });
      });
    });
  });

});

function drawLogo(cb){
  nokia5110.drawPreSizedBitmap(tessel_logo);
  nokia5110.update(function(err){
    cb();
  });
};

function demoIntro(cb){
  nokia5110.clear();
  nokia5110.print("Nokia 5110", nokia5110.CENTER, 0);
  nokia5110.print("DEMO", nokia5110.CENTER, 20);
  nokia5110.drawRect(28, 18, 56, 28);
  for (var i=0; i<6; i++)
  {
    nokia5110.drawLine(57, 18+(i*2), 83-(i*3), 18+(i*2));
    nokia5110.drawLine((i*3), 28-(i*2), 28, 28-(i*2));
  }
  nokia5110.setFont(nokia5110.fonts.TinyFont);
  nokia5110.print("Port of LCD5110_Graph", nokia5110.CENTER, 36);
  nokia5110.print("by Henning Karlsen", nokia5110.CENTER, 42);
  nokia5110.update(function(err){
    setTimeout(cb, 4000);
  });
};

function drawLines(cb){
  nokia5110.clear();
  var i = 0;

  var f = function(){
    if(i >= 0){
      nokia5110.drawLine(i, 0, 83 - i, 47);
      nokia5110.update(function(err){
        i -= 2;
        f();
      });
    }
    else{
      cb();
    }
  };

  var makeLine = function(){
    if(i < 48){
      nokia5110.drawLine(0, i, 83, 47-i);
      nokia5110.update(function(err){
        i+=2;
        makeLine();
      });
    }
    else{
      i = 83;
      setImmediate(f);
    }
  };

  setImmediate(makeLine);
};

function drawEye(cb){
  nokia5110.clear();
  nokia5110.drawRect(0, 0, 83, 47);
  var i = 0;

  var f = function(){
    if(i < 48){
      nokia5110.drawLine(83, 47-i, 83-(parseInt(i*1.75)), 0);
      nokia5110.update(function(err){
        i += 4;
        f();
      });
    }
    else{
      cb();
    }
  };

  var g = function(){
    if(i < 48){
      nokia5110.drawLine(0, i, i*1.75, 47);
      nokia5110.update(function(err){
        i+=4;
        g();
      });
    }
    else{
      i = 0;
      setImmediate(f);
    }
  };

  setImmediate(g);
};

function drawRectangles(cb){
  nokia5110.clear();
  var i = 0;

  var f = function(){
    if(i < 8){
      nokia5110.drawRoundRect(i*3, i*3, 83-(i*3), 47-(i*3));
      nokia5110.update(function(err){
        i ++;
        f();
      });
    }
    else{
      cb();
    }
  };

  setImmediate(f);
}

function drawCircles(cb){
  nokia5110.clear();
  var i = 0;

  var f = function(){
    if(i < 17){
      nokia5110.drawCircle(41, 23, i*3);
      nokia5110.update(function(err){
        i ++;
        f();
      });
    }
    else{
      cb();
    }
  };

  setImmediate(f);
}

function drawGraph(cb){
  nokia5110.clear();
  nokia5110.drawRect(0, 0, 83, 47);
  nokia5110.drawLine(0, 23, 84, 23);
  nokia5110.drawLine(41, 0, 41, 47);

  var c = 0;
  var i = 0;

  var f = function(){
    if(i < 84){
      var y = i*0.017453292519943295769236907684886;
      nokia5110.invPixel(i, (Math.sin(y*6)*20)+23);
      nokia5110.update(function(err){
        i++;
        f();
      });
    }
    else{
      g();
    }
  };

  var g = function(){
    if(c < 4){
      c++;
      f();
    }
    else{
      cb();
    }
  };

  setImmediate(g);
}

// This runs very slow
function pacman(cb){
  var y = Math.floor(Math.random() * 40);

  var pc = 0;
  var pacy = 0;
  var i = -20;
  var bm = 0;

  var f = function(){
    if(i < 84){
      nokia5110.clear();
      for (var p = 4; p>(parseInt((i+20)/20)); p--)
        nokia5110.drawBitmap(p*20-8, pacy+7, pill, 5, 5);
      switch(parseInt((i+20)/3) % 4)
      {
        case 0: bm=pacman1;
                break;
        case 1: bm=pacman2;
                break;
        case 2: bm=pacman3;
                break;
        case 3: bm=pacman2;
                break;
      }
      nokia5110.drawBitmap(i, pacy, bm, 20, 20);
      nokia5110.update(function(err){
        i++;
        f();
      });
    }
    else{
      g();
    }
  };

  var g = function(){
    if(pc < 3){
      pacy = Math.floor(Math.random() * 28);
      pc++;
      f();
    }
    else{
      cb();
    }
  };

  setImmediate(g);
}

function theEnd(cb){
  nokia5110.clear();
  nokia5110.drawPreSizedBitmap(The_End);
  nokia5110.update(function(err){
    cb();
  });

  // var f = function(){
  //   if(i < 25){
  //     nokia5110.clear();
  //     nokia5110.drawBitmap(0, i-24, The_End, 84, 24);
  //     nokia5110.update(function(err){
  //       i ++;
  //       f();
  //     });
  //   }
  //   else{
  //     cb();
  //   }
  // };

  // setImmediate(f);
}